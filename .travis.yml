dist: xenial
language: generic
cache:
  directories:
  - "$HOME/.stack"
addons:
  apt:
    packages:
    - libgmp-dev
before_install:
- mkdir -p ~/.local/bin
- export PATH=$HOME/.local/bin:$PATH
- travis_retry curl -L https://get.haskellstack.org/stable/linux-x86_64.tar.gz | tar
  xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'
install:
- stack --no-terminal --install-ghc test --only-dependencies
script:
- stack --no-terminal test --haddock --no-haddock-deps
before_deploy:
- zip -r $TRAVIS_COMMIT .
- mkdir -p upload
- mv $TRAVIS_COMMIT.zip upload/$TRAVIS_COMMIT.zip
deploy:
- provider: s3
  access_key_id: "$ACCESS_KEY_ID"
  secret_access_key:
    secure: j+Gzend63b9CBFfAvYWWrqw09IywDF+gb4Tp9PZ+rneQkx68mZ7gbdGZ0+hIbD+hqywhOnc3F8wKfC3sEQPrb9u2+gBFH19FoPuG+Cs37MK6Hrbam0dz/UOx7cS9Yi2LNIcWBCq+m1UbpksTYMHOVIRVL//GabAKGcrzXWUYkEcgwP5+t5GUEtlhhakk9RG2nut+UftMCzHmltrN+kLe3bWyBX47fCtsm3tf/FpHNrqYrT4Jfw/Nyk7YSwsxUttKL9TiqUEDbL/z1ddfbQ0yfoz4n4SaDNGvCxnVYoQxcKRXNOjA69oZj95qcr1YqqZFYVfm+LFg/34xBPJQCofPQlgykevURYgVPzuRnhMxNsfe+tGpY0xwrdjFSHiXW7qMQQPtzjynv6TQeERsQY9pCj7v8YGWxImGc8hpwTEi29AstiInQUV95/DY5d3Ppdq8teMqM3kNduSAkuM1ZbKdJ/kWf5xck/MnvfTMJm4T/oyv3TZYa7QirvV9Quhv6BVQiH/uap+ExoqTFVU1MuJMYwWgoKZtCmhF1vDj9vvfTv0laQjThM/zsZ8nLJr0OdcLIsZxAh1JjH75vW2hTdotyeuDzCmJfJOHXUHauMoJLsfl+oFD1v4gfA0KQngb2w2ISb+V6UxML090a8w5agV+RBRSAV4KDpCcMps0fZR6rtY=
  skip_cleanup: true
  local_dir: upload
  bucket: tslaq-deployments
  upload-dir: tslaq-event-tracker
  dot_match: true
  acl: private
  on:
    repo: amiri/tslaq-event-tracker
- provider: codedeploy
  access_key_id: "$ACCESS_KEY_ID"
  secret_access_key:
    secure: j+Gzend63b9CBFfAvYWWrqw09IywDF+gb4Tp9PZ+rneQkx68mZ7gbdGZ0+hIbD+hqywhOnc3F8wKfC3sEQPrb9u2+gBFH19FoPuG+Cs37MK6Hrbam0dz/UOx7cS9Yi2LNIcWBCq+m1UbpksTYMHOVIRVL//GabAKGcrzXWUYkEcgwP5+t5GUEtlhhakk9RG2nut+UftMCzHmltrN+kLe3bWyBX47fCtsm3tf/FpHNrqYrT4Jfw/Nyk7YSwsxUttKL9TiqUEDbL/z1ddfbQ0yfoz4n4SaDNGvCxnVYoQxcKRXNOjA69oZj95qcr1YqqZFYVfm+LFg/34xBPJQCofPQlgykevURYgVPzuRnhMxNsfe+tGpY0xwrdjFSHiXW7qMQQPtzjynv6TQeERsQY9pCj7v8YGWxImGc8hpwTEi29AstiInQUV95/DY5d3Ppdq8teMqM3kNduSAkuM1ZbKdJ/kWf5xck/MnvfTMJm4T/oyv3TZYa7QirvV9Quhv6BVQiH/uap+ExoqTFVU1MuJMYwWgoKZtCmhF1vDj9vvfTv0laQjThM/zsZ8nLJr0OdcLIsZxAh1JjH75vW2hTdotyeuDzCmJfJOHXUHauMoJLsfl+oFD1v4gfA0KQngb2w2ISb+V6UxML090a8w5agV+RBRSAV4KDpCcMps0fZR6rtY=
  bucket: tslaq-deployments
  bundle_type: zip
  key: tslaq-event-tracker/$TRAVIS_COMMIT.zip
  application: tslaq-event-tracker
  deployment_group: tslaq-event-tracker
  wait_until_deployed: true
